<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5600315940410875"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Stocks - 200-Week Moving Average Screener | mungbeans.io</title>
  <meta name="description" content="Screen 1,700+ stocks against their 200-week moving average. Filter by signal status, insider buying, free cash flow trends, Buffett quality, and Dividend Aristocrats. Updated weekly.">
  <link rel="canonical" href="{{ .Permalink }}">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header class="site-header">
    <nav>
      <a href="/" class="logo">mungbeans.io</a>
      <a href="/stocks/">All Stocks</a>
      <a href="/about/">About</a>
    </nav>
  </header>

  {{ $data := dict }}
  {{ with resources.Get "data/stocks.json" }}
    {{ with . | transform.Unmarshal }}
      {{ $data = . }}
    {{ end }}
  {{ end }}

  <main class="stocks-list-page">
    <h1>All Stocks</h1>
    <p class="page-desc">{{ $data.summary.total_stocks }} stocks tracked. Data as of {{ $data.generated_readable }}.</p>

    <!-- Search Box -->
    <div class="search-container">
      <input type="text" id="stockSearch" placeholder="Search by symbol or name..." class="search-input">
    </div>

    <!-- Filter Groups -->
    <div class="filter-section">
      <div class="filter-group">
        <label class="filter-label">Signal</label>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter-group="signal" data-filter="all">All</button>
          <button class="filter-btn" data-filter-group="signal" data-filter="below">Below Line</button>
          <button class="filter-btn" data-filter-group="signal" data-filter="quality">Quality Zone</button>
          <button class="filter-btn" data-filter-group="signal" data-filter="approaching">Approaching</button>
          <button class="filter-btn" data-filter-group="signal" data-filter="oversold">Oversold</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Quality</label>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter-group="quality" data-filter="all">All</button>
          <button class="filter-btn" data-filter-group="quality" data-filter="sp500">S&P 500</button>
          <button class="filter-btn" data-filter-group="quality" data-filter="proven">Proven Bouncers</button>
          <button class="filter-btn" data-filter-group="quality" data-filter="lowdebt" title="Debt/Equity < 50%">Low Debt</button>
          <button class="filter-btn" data-filter-group="quality" data-filter="highroe" title="Return on Equity > 15%">High ROE</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Cross History</label>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter-group="history" data-filter="all">All</button>
          <button class="filter-btn" data-filter-group="history" data-filter="firsttime">First Time</button>
          <button class="filter-btn" data-filter-group="history" data-filter="rare">Rare (1-2)</button>
          <button class="filter-btn" data-filter-group="history" data-filter="frequent">Frequent (5+)</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Special</label>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter-group="special" data-filter="all">All</button>
          <button class="filter-btn buffett-btn" data-filter-group="special" data-filter="buffett" title="High ROE + Low Debt + Positive FCF + Profitable">üèÜ Buffett Quality</button>
          <button class="filter-btn yartseva-btn" data-filter-group="special" data-filter="yartseva" title="Small cap + High FCF yield + Value P/B">üéØ Multibagger</button>
          <button class="filter-btn aristocrat-btn" data-filter-group="special" data-filter="aristocrat" title="25+ years consecutive dividend increases">üëë Aristocrats</button>
          <button class="filter-btn moat-btn" data-filter-group="special" data-filter="widemoat" title="Gross Margin > 40% + ROE > 15%">üè∞ Wide Moat</button>
          <button class="filter-btn cannibal-btn" data-filter-group="special" data-filter="cannibal" title="Shrinking share count by 5%+ over 3 years">ü¶à Cannibals</button>
          <button class="filter-btn diluter-btn" data-filter-group="special" data-filter="diluter" title="Growing share count by 2%+ over 3 years">‚ö†Ô∏è Diluters</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Sector</label>
        <select id="sectorFilter" class="sector-select">
          <option value="all">All Sectors</option>
        </select>
      </div>
    </div>
    
    <!-- Info Boxes (hidden by default) -->
    <div id="buffettInfo" class="info-box buffett-info" style="display: none;">
      <strong>üèÜ Buffett Quality Screen</strong>
      <p>Companies meeting Warren Buffett's core investment criteria:</p>
      <ul>
        <li>High ROE (&gt; 15%) ‚Äî efficient use of shareholder capital</li>
        <li>Low Debt (D/E &lt; 50%) ‚Äî conservative balance sheet</li>
        <li>Positive Free Cash Flow ‚Äî real earnings, not accounting tricks</li>
        <li>Profitable ‚Äî actually making money</li>
      </ul>
      <p class="info-note">"A truly great business must have an enduring moat that protects excellent returns on invested capital." ‚Äî Buffett</p>
    </div>
    
    <div id="yartsevaInfo" class="info-box yartseva-info" style="display: none;">
      <strong>üéØ Yartseva Multibagger Screen</strong>
      <p>Based on statistical research of 464 stocks that 5-10x'd from 2009-2024:</p>
      <ul>
        <li>Market cap &lt; $2B (small caps dominated)</li>
        <li>FCF Yield &gt; 5% (cash generation matters most)</li>
        <li>Book-to-Market &gt; 0.40 (value pricing)</li>
        <li>Positive equity + Below 200WMA (near lows)</li>
      </ul>
      <p class="info-note">These meet quantitative criteria. Always verify improving margins and reinvestment quality.</p>
    </div>
    
    <div id="aristocratInfo" class="info-box aristocrat-info" style="display: none;">
      <strong>üëë Dividend Aristocrats</strong>
      <p>S&P 500 companies with 25+ consecutive years of dividend increases:</p>
      <ul>
        <li>Proven durability through multiple economic cycles</li>
        <li>Management committed to returning capital</li>
        <li>Usually have strong competitive moats</li>
        <li>When below 200WMA = rare buying opportunity</li>
      </ul>
      <p class="info-note">Aristocrats rarely go on sale. A 200WMA cross is often a generational entry point.</p>
    </div>
    
    <div id="moatInfo" class="info-box moat-info" style="display: none;">
      <strong>üè∞ Wide Moat Screen</strong>
      <p>Companies with durable competitive advantages:</p>
      <ul>
        <li>Gross Margin &gt; 40% ‚Äî strong pricing power</li>
        <li>ROE &gt; 15% ‚Äî efficient capital allocation</li>
        <li>These margins indicate barriers to competition</li>
      </ul>
      <p class="info-note">"The key to investing is determining the competitive advantage of any given company and the durability of that advantage." ‚Äî Buffett</p>
    </div>
    
    <div id="cannibalInfo" class="info-box cannibal-info" style="display: none;">
      <strong>ü¶à Cannibals (Aggressive Buybacks)</strong>
      <p>Companies aggressively eating their own shares:</p>
      <ul>
        <li>Share count reduced by &gt; 5% over 3 years</li>
        <li>Fewer shares = your slice of profits grows</li>
        <li>Shows management confidence + shareholder alignment</li>
        <li>Buffett calls these "cannibal" companies</li>
      </ul>
      <p class="info-note">"When stock can be bought below a business's value it is probably the best use of cash." ‚Äî Buffett</p>
    </div>
    
    <div id="diluterInfo" class="info-box diluter-info" style="display: none;">
      <strong>‚ö†Ô∏è Diluters (Share Count Growing)</strong>
      <p>Companies increasing their share count:</p>
      <ul>
        <li>Share count increased by &gt; 2% over 3 years</li>
        <li>Often from stock-based compensation or secondary offerings</li>
        <li>Dilutes existing shareholders' ownership stake</li>
        <li>Not always bad, but requires scrutiny</li>
      </ul>
      <p class="info-note">Watch for: excessive SBC, frequent capital raises, or acquisitions funded by stock.</p>
    </div>

    <!-- Stocks Table -->
    <table class="stocks-table" id="stocksTable">
      <thead>
        <tr>
          <th class="sortable" data-sort="symbol">Symbol <span class="sort-icon">‚Üï</span></th>
          <th>Signal</th>
          <th class="sortable" data-sort="distance">Distance <span class="sort-icon">‚Üï</span></th>
          <th>Direction</th>
          <th class="sortable" data-sort="rsi">RSI <span class="sort-icon">‚Üï</span></th>
          <th class="sortable" data-sort="roe">ROE <span class="sort-icon">‚Üï</span></th>
          <th class="sortable hide-mobile" data-sort="debt">D/E <span class="sort-icon">‚Üï</span></th>
          <th class="sortable hide-mobile" data-sort="shares">Shares <span class="sort-icon">‚Üï</span></th>
          <th class="sortable hide-mobile" data-sort="fcfyield">FCF% <span class="sort-icon">‚Üï</span></th>
          <th class="hide-tablet">Sector</th>
        </tr>
      </thead>
      <tbody>
        {{ range $data.stocks }}
        {{ $depth := .pct_from_wma }}
        {{ $absDepth := math.Abs .pct_from_wma }}
        {{ $hasOngoingTouch := false }}
        {{ range .historical_touches }}
          {{ if .ongoing }}{{ $hasOngoingTouch = true }}{{ end }}
        {{ end }}
        <tr class="stock-row zone-{{ .zone }}{{ if .buffett_below_line }} buffett-match{{ end }}{{ if .yartseva_below_line }} yartseva-match{{ end }}{{ if .aristocrat_below_line }} aristocrat-match{{ end }}{{ if .cannibal_below_line }} cannibal-match{{ end }}" 
            data-symbol="{{ .symbol }}"
            data-name="{{ .name }}"
            data-sector="{{ .sector }}"
            data-below="{{ .below_line }}" 
            data-distance="{{ $depth }}"
            data-abs-distance="{{ $absDepth }}"
            data-rsi="{{ .rsi_14 }}"
            data-roe="{{ if .roe }}{{ .roe }}{{ else }}-999{{ end }}"
            data-debt="{{ if .debt_to_equity }}{{ .debt_to_equity }}{{ else }}9999{{ end }}"
            data-fcfyield="{{ if .fcf_yield }}{{ .fcf_yield }}{{ else }}-999{{ end }}"
            data-touches="{{ .touch_count }}"
            data-avgreturn="{{ if .avg_return_after_touch }}{{ .avg_return_after_touch }}{{ else }}-999{{ end }}"
            data-approaching="{{ and (not .below_line) (le .pct_from_wma 15.0) }}"
            data-oversold="{{ lt .rsi_14 30.0 }}"
            data-quality="{{ and .below_line (lt $absDepth 50.0) }}"
            data-proven="{{ and .avg_return_after_touch (gt .avg_return_after_touch 0.0) }}"
            data-firsttime="{{ and .below_line (le .touch_count 1) }}"
            data-ongoing="{{ $hasOngoingTouch }}"
            data-lowdebt="{{ if .low_debt }}true{{ else }}false{{ end }}"
            data-highroe="{{ if .high_roe }}true{{ else }}false{{ end }}"
            data-widemoat="{{ if .wide_moat }}true{{ else }}false{{ end }}"
            data-buffett="{{ if .buffett_below_line }}true{{ else }}false{{ end }}"
            data-yartseva="{{ if .yartseva_below_line }}true{{ else }}false{{ end }}"
            data-aristocrat="{{ if .aristocrat_below_line }}true{{ else }}false{{ end }}"
            data-cannibal="{{ if .cannibal_below_line }}true{{ else }}false{{ end }}"
            data-diluter="{{ if .is_diluting }}true{{ else }}false{{ end }}"
            data-shares="{{ if .shares_change_3yr }}{{ .shares_change_3yr }}{{ else }}0{{ end }}"
            data-dividend-aristocrat="{{ if .dividend_aristocrat }}true{{ else }}false{{ end }}">
          <td>
            <a href="/stocks/{{ .symbol | lower }}/">{{ .symbol }}</a>
            {{ if .buffett_below_line }}<span class="badge-inline buffett-badge" title="Buffett Quality">üèÜ</span>{{ end }}
            {{ if .yartseva_below_line }}<span class="badge-inline yartseva-badge" title="Multibagger Candidate">üéØ</span>{{ end }}
            {{ if .aristocrat_below_line }}<span class="badge-inline aristocrat-badge" title="Dividend Aristocrat">üëë</span>{{ end }}
            {{ if .cannibal_below_line }}<span class="badge-inline cannibal-badge" title="Cannibal (Buybacks)">ü¶à</span>{{ end }}
            {{ if .name }}<span class="stock-name">{{ .name }}</span>{{ end }}
          </td>
          <td>
            {{ if .below_line }}
              <span class="signal-badge yes">YES</span>
            {{ else }}
              <span class="signal-badge no">NO</span>
            {{ end }}
          </td>
          <td class="mono">
            {{ if .below_line }}
              {{ printf "%.1f%%" $absDepth }} below
            {{ else }}
              {{ printf "%.1f%%" .pct_from_wma }} above
            {{ end }}
          </td>
          <td>
            {{ if .approaching }}
              <span class="direction approaching">‚Üì</span>
            {{ else }}
              <span class="direction retreating">‚Üë</span>
            {{ end }}
          </td>
          <td class="mono {{ if lt .rsi_14 30.0 }}oversold{{ end }}">
            {{ printf "%.0f" .rsi_14 }}
          </td>
          <td class="mono {{ if and .roe (gt .roe 15.0) }}high-roe{{ end }}">
            {{ if .roe }}{{ printf "%.0f%%" .roe }}{{ else }}‚Äî{{ end }}
          </td>
          <td class="mono hide-mobile {{ if and .debt_to_equity (lt .debt_to_equity 50.0) }}low-debt{{ end }}">
            {{ if .debt_to_equity }}{{ printf "%.0f%%" .debt_to_equity }}{{ else }}‚Äî{{ end }}
          </td>
          <td class="mono hide-mobile {{ if and .shares_change_3yr (lt .shares_change_3yr -2.0) }}buyback{{ else if and .shares_change_3yr (gt .shares_change_3yr 2.0) }}diluting{{ end }}">
            {{ if .shares_change_3yr }}{{ printf "%+.0f%%" .shares_change_3yr }}{{ else }}‚Äî{{ end }}
          </td>
          <td class="mono hide-mobile {{ if and .fcf_yield (gt .fcf_yield 5.0) }}high-fcf{{ end }}">
            {{ if .fcf_yield }}{{ printf "%.1f%%" .fcf_yield }}{{ else }}‚Äî{{ end }}
          </td>
          <td class="sector-cell hide-tablet">{{ if .sector }}{{ .sector }}{{ else }}‚Äî{{ end }}</td>
        </tr>
        {{ end }}
      </tbody>
    </table>
    
    <p class="results-count" id="resultsCount"></p>
    
    <!-- Affiliate CTA -->
    <div class="affiliate-box">
      <p class="affiliate-text">Ready to trade? Open a commission-free account:</p>
      <div class="affiliate-links">
        <a href="https://robinhood.com/signup" target="_blank" rel="noopener sponsored" class="affiliate-link">Robinhood</a>
        <a href="https://www.webull.com/introduce" target="_blank" rel="noopener sponsored" class="affiliate-link">Webull</a>
        <a href="https://www.interactivebrokers.com" target="_blank" rel="noopener sponsored" class="affiliate-link">Interactive Brokers</a>
      </div>
      <p class="affiliate-disclosure">Affiliate links. We may earn a commission.</p>
    </div>
  </main>

  <footer class="site-footer">
    <p>¬© {{ now.Year }} mungbeans.io. <a href="/disclaimer/">Disclaimer</a> ¬∑ <a href="/privacy/">Privacy</a></p>
  </footer>

  <script>
    // S&P 500 constituents
    const SP500 = new Set([
      'AAPL','ABBV','ABT','ACN','ADBE','ADP','ADSK','AEE','AEP','AES','AFL','AIG','AIZ','AJG','AKAM','ALB','ALGN','ALL','ALLE','AMAT','AMCR','AMD','AME','AMGN','AMP','AMT','AMZN','ANET','ANSS','AON','AOS','APA','APD','APH','APTV','ARE','ATO','AVB','AVGO','AVY','AWK','AXON','AXP','AZO',
      'BA','BAC','BALL','BAX','BBY','BDX','BEN','BF-B','BG','BIIB','BIO','BK','BKNG','BKR','BLDR','BLK','BMY','BR','BRK-B','BRO','BSX','BWA','BX','BXP',
      'C','CAG','CAH','CARR','CAT','CB','CBOE','CBRE','CCI','CCL','CDNS','CDW','CE','CEG','CF','CFG','CHD','CHRW','CHTR','CI','CINF','CL','CLX','CMA','CMCSA','CME','CMG','CMI','CMS','CNC','CNP','COF','COO','COP','COR','COST','CPAY','CPB','CPRT','CPT','CRL','CRM','CSCO','CSGP','CSX','CTAS','CTLT','CTRA','CTSH','CTVA','CVS','CVX',
      'D','DAL','DAY','DD','DE','DECK','DFS','DG','DGX','DHI','DHR','DIS','DLR','DLTR','DOC','DOV','DOW','DPZ','DRI','DTE','DUK','DVA','DVN',
      'DXCM','EA','EBAY','ECL','ED','EFX','EG','EIX','EL','ELV','EMN','EMR','ENPH','EOG','EPAM','EQIX','EQR','EQT','ES','ESS','ETN','ETR','EVRG','EW','EXC','EXPD','EXPE','EXR',
      'F','FANG','FAST','FCX','FDS','FDX','FE','FFIV','FI','FICO','FIS','FITB','FMC','FOX','FOXA','FRT','FSLR','FTNT','FTV',
      'GD','GDDY','GE','GEHC','GEN','GEV','GILD','GIS','GL','GLW','GM','GNRC','GOOG','GOOGL','GPC','GPN','GRMN','GS','GWW',
      'HAL','HAS','HBAN','HCA','HD','HES','HIG','HII','HLT','HOLX','HON','HPE','HPQ','HRL','HSIC','HST','HSY','HUBB','HUM','HWM',
      'IBM','ICE','IDXX','IEX','IFF','ILMN','INCY','INTC','INTU','INVH','IP','IPG','IQV','IR','IRM','ISRG','IT','ITW','IVZ',
      'J','JBHT','JBL','JCI','JKHY','JNJ','JNPR','JPM',
      'K','KDP','KEY','KEYS','KHC','KIM','KKR','KLAC','KMB','KMI','KMX','KO','KR',
      'L','LDOS','LEN','LH','LHX','LIN','LKQ','LLY','LMT','LNT','LOW','LRCX','LULU','LUV','LVS','LW','LYB','LYV',
      'MA','MAA','MAR','MAS','MCD','MCHP','MCK','MCO','MDLZ','MDT','MET','META','MGM','MHK','MKC','MKTX','MLM','MMC','MMM','MNST','MO','MOH','MOS','MPC','MPWR','MRK','MRNA','MRO','MS','MSCI','MSFT','MSI','MTB','MTCH','MTD','MU',
      'NCLH','NDAQ','NDSN','NEE','NEM','NFLX','NI','NKE','NOC','NOW','NRG','NSC','NTAP','NTRS','NUE','NVDA','NVR','NWS','NWSA',
      'O','ODFL','OKE','OMC','ON','ORCL','ORLY','OTIS','OXY',
      'PANW','PARA','PAYC','PAYX','PCAR','PCG','PEG','PEP','PFE','PFG','PG','PGR','PH','PHM','PKG','PLD','PLTR','PM','PNC','PNR','PNW','PODD','POOL','PPG','PPL','PRU','PSA','PSX','PTC','PWR','PXD',
      'QCOM','QRVO',
      'RCL','REG','REGN','RF','RJF','RL','RMD','ROK','ROL','ROP','ROST','RSG','RTX',
      'SBAC','SBUX','SCHW','SHW','SJM','SLB','SMCI','SNA','SNPS','SO','SOLV','SPG','SPGI','SRE','STE','STLD','STT','STX','STZ','SWK','SWKS','SYF','SYK','SYY',
      'T','TAP','TDG','TDY','TECH','TEL','TER','TFC','TFX','TGT','TJX','TMO','TMUS','TPR','TRGP','TRMB','TROW','TRV','TSCO','TSLA','TSN','TT','TTWO','TXN','TXT','TYL',
      'UAL','UBER','UDR','UHS','ULTA','UNH','UNP','UPS','URI','USB',
      'V','VICI','VLO','VLTO','VMC','VRSK','VRSN','VRTX','VST','VTR','VTRS','VZ',
      'WAB','WAT','WBA','WBD','WDC','WEC','WELL','WFC','WM','WMB','WMT','WRB','WRK','WST','WTW','WY','WYNN',
      'XEL','XOM','XYL','YUM','ZBH','ZBRA','ZTS'
    ]);
    
    // State
    let currentSort = { column: null, direction: 'asc' };
    let filters = { signal: 'all', quality: 'all', history: 'all', special: 'all', sector: 'all', search: '' };
    
    // Elements
    const table = document.getElementById('stocksTable');
    const tbody = table.querySelector('tbody');
    const searchInput = document.getElementById('stockSearch');
    const sectorSelect = document.getElementById('sectorFilter');
    const resultsCount = document.getElementById('resultsCount');
    
    // Info boxes
    const infoBoxes = {
      buffett: document.getElementById('buffettInfo'),
      yartseva: document.getElementById('yartsevaInfo'),
      aristocrat: document.getElementById('aristocratInfo'),
      widemoat: document.getElementById('moatInfo'),
      cannibal: document.getElementById('cannibalInfo'),
      diluter: document.getElementById('diluterInfo')
    };
    
    // Populate sector dropdown
    const sectors = new Set();
    document.querySelectorAll('.stock-row').forEach(row => {
      const sector = row.dataset.sector;
      if (sector && sector !== '') sectors.add(sector);
    });
    Array.from(sectors).sort().forEach(sector => {
      const opt = document.createElement('option');
      opt.value = sector;
      opt.textContent = sector;
      sectorSelect.appendChild(opt);
    });
    
    // Add S&P 500 data attribute
    document.querySelectorAll('.stock-row').forEach(row => {
      row.dataset.sp500 = SP500.has(row.dataset.symbol) ? 'true' : 'false';
    });
    
    function getRows() { return Array.from(tbody.querySelectorAll('.stock-row')); }
    
    function updateCount() {
      const visible = getRows().filter(row => row.style.display !== 'none').length;
      resultsCount.textContent = `Showing ${visible} of ${getRows().length} stocks`;
    }
    
    function hideAllInfoBoxes() {
      Object.values(infoBoxes).forEach(box => { if (box) box.style.display = 'none'; });
    }
    
    // Filter button clicks
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.dataset.filterGroup;
        
        document.querySelectorAll(`.filter-btn[data-filter-group="${group}"]`).forEach(b => {
          b.classList.remove('active');
        });
        btn.classList.add('active');
        filters[group] = btn.dataset.filter;
        
        // Show/hide info boxes
        if (group === 'special') {
          hideAllInfoBoxes();
          if (infoBoxes[btn.dataset.filter]) {
            infoBoxes[btn.dataset.filter].style.display = 'block';
          }
        }
        
        applyFilters();
      });
    });
    
    sectorSelect.addEventListener('change', () => { filters.sector = sectorSelect.value; applyFilters(); });
    searchInput.addEventListener('input', () => { filters.search = searchInput.value.toUpperCase(); applyFilters(); });
    
    function applyFilters() {
      getRows().forEach(row => {
        let show = true;
        
        // Search
        if (filters.search) {
          const symbol = row.dataset.symbol || '';
          const name = (row.dataset.name || '').toUpperCase();
          if (!symbol.includes(filters.search) && !name.includes(filters.search)) show = false;
        }
        
        // Signal
        if (show && filters.signal !== 'all') {
          if (filters.signal === 'below') show = row.dataset.below === 'true';
          else if (filters.signal === 'quality') show = row.dataset.quality === 'true';
          else if (filters.signal === 'approaching') show = row.dataset.approaching === 'true';
          else if (filters.signal === 'oversold') show = row.dataset.oversold === 'true';
        }
        
        // Quality
        if (show && filters.quality !== 'all') {
          if (filters.quality === 'sp500') show = row.dataset.sp500 === 'true';
          else if (filters.quality === 'proven') show = row.dataset.proven === 'true';
          else if (filters.quality === 'lowdebt') show = row.dataset.lowdebt === 'true';
          else if (filters.quality === 'highroe') show = row.dataset.highroe === 'true';
        }
        
        // History
        if (show && filters.history !== 'all') {
          const touches = parseInt(row.dataset.touches) || 0;
          const isBelow = row.dataset.below === 'true';
          if (filters.history === 'firsttime') show = isBelow && touches <= 1;
          else if (filters.history === 'rare') show = touches >= 1 && touches <= 2;
          else if (filters.history === 'frequent') show = touches >= 5;
        }
        
        // Special (quality screens - only shows stocks BELOW the line that meet criteria)
        if (show && filters.special !== 'all') {
          if (filters.special === 'buffett') show = row.dataset.buffett === 'true';
          else if (filters.special === 'yartseva') show = row.dataset.yartseva === 'true';
          else if (filters.special === 'aristocrat') show = row.dataset.aristocrat === 'true';
          else if (filters.special === 'widemoat') show = row.dataset.widemoat === 'true' && row.dataset.below === 'true';
          else if (filters.special === 'cannibal') show = row.dataset.cannibal === 'true';
          else if (filters.special === 'diluter') show = row.dataset.diluter === 'true';
        }
        
        // Sector
        if (show && filters.sector !== 'all') show = row.dataset.sector === filters.sector;
        
        row.style.display = show ? '' : 'none';
      });
      updateCount();
    }
    
    // Sort
    document.querySelectorAll('.sortable').forEach(th => {
      th.addEventListener('click', () => {
        const column = th.dataset.sort;
        if (currentSort.column === column) {
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = column;
          currentSort.direction = 'asc';
        }
        document.querySelectorAll('.sortable').forEach(h => h.classList.remove('sort-asc', 'sort-desc'));
        th.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
        sortTable(column, currentSort.direction);
      });
    });
    
    function sortTable(column, direction) {
      const rows = getRows();
      rows.sort((a, b) => {
        let aVal, bVal;
        if (column === 'symbol') {
          return direction === 'asc' ? a.dataset.symbol.localeCompare(b.dataset.symbol) : b.dataset.symbol.localeCompare(a.dataset.symbol);
        }
        const map = { distance: 'distance', rsi: 'rsi', roe: 'roe', debt: 'debt', shares: 'shares', fcfyield: 'fcfyield', touches: 'touches', avgreturn: 'avgreturn' };
        aVal = parseFloat(a.dataset[map[column]]) || 0;
        bVal = parseFloat(b.dataset[map[column]]) || 0;
        return direction === 'asc' ? aVal - bVal : bVal - aVal;
      });
      rows.forEach(row => tbody.appendChild(row));
    }
    
    updateCount();
  </script>

  <style>
    .stocks-list-page { max-width: 1200px; }
    .page-desc { color: var(--color-text-muted); margin-bottom: var(--space-lg); }
    .search-container { margin-bottom: var(--space-lg); }
    .search-input { width: 100%; max-width: 350px; padding: var(--space-sm) var(--space-md); border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-surface); color: var(--color-text); font-size: 1rem; }
    .search-input:focus { outline: none; border-color: var(--color-primary, #3b82f6); }
    .filter-section { display: flex; flex-direction: column; gap: var(--space-md); margin-bottom: var(--space-lg); padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); }
    .filter-group { display: flex; flex-wrap: wrap; align-items: center; gap: var(--space-sm); }
    .filter-label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-text-muted); min-width: 100px; }
    .filter-controls { display: flex; gap: var(--space-xs); flex-wrap: wrap; }
    .filter-btn { background: var(--color-bg); border: 1px solid var(--color-border); border-radius: var(--radius-sm); padding: 6px 12px; color: var(--color-text-muted); cursor: pointer; font-size: 0.8125rem; transition: all 0.15s ease; }
    .filter-btn:hover { border-color: var(--color-text-muted); color: var(--color-text); }
    .filter-btn.active { background: var(--color-primary, #3b82f6); border-color: var(--color-primary, #3b82f6); color: white; }
    
    /* Special filter button styles */
    .buffett-btn { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-color: #047857; color: white; }
    .buffett-btn:hover { background: linear-gradient(135deg, #047857 0%, #065f46 100%); color: white; }
    .buffett-btn.active { background: linear-gradient(135deg, #065f46 0%, #064e3b 100%); box-shadow: 0 0 0 2px rgba(5, 150, 105, 0.3); }
    
    .yartseva-btn { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #d97706; color: white; }
    .yartseva-btn:hover { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: white; }
    .yartseva-btn.active { background: linear-gradient(135deg, #b45309 0%, #92400e 100%); box-shadow: 0 0 0 2px rgba(217, 119, 6, 0.3); }
    
    .aristocrat-btn { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border-color: #6d28d9; color: white; }
    .aristocrat-btn:hover { background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%); color: white; }
    .aristocrat-btn.active { background: linear-gradient(135deg, #5b21b6 0%, #4c1d95 100%); box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.3); }
    
    .moat-btn { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); border-color: #0284c7; color: white; }
    .moat-btn:hover { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); color: white; }
    .moat-btn.active { background: linear-gradient(135deg, #0369a1 0%, #075985 100%); box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3); }
    
    .cannibal-btn { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border-color: #0891b2; color: white; }
    .cannibal-btn:hover { background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); color: white; }
    .cannibal-btn.active { background: linear-gradient(135deg, #0e7490 0%, #155e75 100%); box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.3); }
    
    .diluter-btn { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); border-color: #ef4444; color: white; }
    .diluter-btn:hover { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .diluter-btn.active { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3); }
    
    .sector-select { padding: 6px 12px; border: 1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-bg); color: var(--color-text); font-size: 0.8125rem; min-width: 150px; }
    
    /* Info boxes */
    .info-box { padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); }
    .info-box strong { font-size: 1rem; }
    .info-box p { margin: var(--space-sm) 0; font-size: 0.875rem; }
    .info-box ul { margin: var(--space-sm) 0; padding-left: var(--space-lg); font-size: 0.8125rem; }
    .info-box li { margin-bottom: 4px; }
    .info-note { font-size: 0.75rem !important; color: var(--color-text-muted); font-style: italic; }
    
    .buffett-info { background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(4, 120, 87, 0.1) 100%); border: 1px solid rgba(5, 150, 105, 0.3); }
    .buffett-info strong { color: #059669; }
    .yartseva-info { background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%); border: 1px solid rgba(217, 119, 6, 0.3); }
    .yartseva-info strong { color: #d97706; }
    .aristocrat-info { background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(109, 40, 217, 0.1) 100%); border: 1px solid rgba(124, 58, 237, 0.3); }
    .aristocrat-info strong { color: #7c3aed; }
    .moat-info { background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(2, 132, 199, 0.1) 100%); border: 1px solid rgba(14, 165, 233, 0.3); }
    .moat-info strong { color: #0ea5e9; }
    .cannibal-info { background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(8, 145, 178, 0.1) 100%); border: 1px solid rgba(6, 182, 212, 0.3); }
    .cannibal-info strong { color: #06b6d4; }
    .diluter-info { background: linear-gradient(135deg, rgba(248, 113, 113, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%); border: 1px solid rgba(239, 68, 68, 0.3); }
    .diluter-info strong { color: #ef4444; }
    
    /* Table */
    .stocks-table { width: 100%; border-collapse: collapse; }
    .stocks-table th, .stocks-table td { padding: var(--space-sm) var(--space-md); text-align: left; border-bottom: 1px solid var(--color-border); }
    .stocks-table th { color: var(--color-text-muted); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; position: sticky; top: 0; background: var(--color-bg); z-index: 10; }
    .sortable { cursor: pointer; user-select: none; }
    .sortable:hover { color: var(--color-text); }
    .sort-icon { opacity: 0.3; margin-left: 4px; }
    .sortable.sort-asc .sort-icon, .sortable.sort-desc .sort-icon { opacity: 1; font-size: 0; }
    .sortable.sort-asc .sort-icon::after { content: '‚Üë'; font-size: 0.75rem; }
    .sortable.sort-desc .sort-icon::after { content: '‚Üì'; font-size: 0.75rem; }
    .stocks-table td a { font-weight: 600; }
    .stock-name { display: block; font-size: 0.7rem; color: var(--color-text-muted); font-weight: normal; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .mono { font-family: var(--font-mono); font-size: 0.875rem; }
    .signal-badge { display: inline-block; padding: 2px 8px; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: 700; }
    .signal-badge.yes { background: var(--color-yes-bg); color: var(--zone-below-line); }
    .signal-badge.no { background: var(--color-surface); color: var(--color-text-muted); }
    .direction.approaching { color: var(--color-approaching); font-weight: bold; }
    .direction.retreating { color: var(--color-text-muted); }
    td.oversold { color: var(--zone-below-line); font-weight: 600; }
    td.high-roe { color: #059669; font-weight: 600; }
    td.low-debt { color: #059669; }
    td.high-fcf { color: #d97706; font-weight: 600; }
    td.buyback { color: #06b6d4; font-weight: 600; }
    td.diluting { color: #ef4444; font-weight: 600; }
    
    .badge-inline { display: inline-block; padding: 1px 4px; border-radius: 3px; font-size: 0.7rem; margin-left: 3px; vertical-align: baseline; }
    
    .sector-cell { font-size: 0.75rem; color: var(--color-text-muted); max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .stock-row.zone-below_line, .stock-row.zone-deep_value, .stock-row.zone-extreme_value { background: var(--color-yes-bg); }
    
    /* Quality match highlights */
    .stock-row.buffett-match { background: linear-gradient(90deg, rgba(5, 150, 105, 0.12) 0%, transparent 40%); }
    .stock-row.yartseva-match { background: linear-gradient(90deg, rgba(245, 158, 11, 0.12) 0%, transparent 40%); }
    .stock-row.aristocrat-match { background: linear-gradient(90deg, rgba(124, 58, 237, 0.12) 0%, transparent 40%); }
    .stock-row.cannibal-match { background: linear-gradient(90deg, rgba(6, 182, 212, 0.12) 0%, transparent 40%); }
    
    .results-count { margin-top: var(--space-md); color: var(--color-text-muted); font-size: 0.875rem; }
    
    /* Affiliate */
    .affiliate-box { margin-top: var(--space-xl); padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-md); text-align: center; border: 1px solid var(--color-border); }
    .affiliate-text { margin-bottom: var(--space-md); font-weight: 500; }
    .affiliate-links { display: flex; justify-content: center; gap: var(--space-md); flex-wrap: wrap; margin-bottom: var(--space-sm); }
    .affiliate-link { display: inline-block; padding: var(--space-sm) var(--space-lg); background: var(--color-primary, #3b82f6); color: white; border-radius: var(--radius-sm); text-decoration: none; font-weight: 600; font-size: 0.875rem; transition: background 0.15s ease; }
    .affiliate-link:hover { background: #2563eb; color: white; }
    .affiliate-disclosure { font-size: 0.75rem; color: var(--color-text-muted); }
    
    /* Responsive */
    @media (max-width: 900px) {
      .filter-label { min-width: 70px; font-size: 0.7rem; }
      .filter-btn { padding: 4px 8px; font-size: 0.75rem; }
      .hide-mobile { display: none; }
    }
    @media (max-width: 600px) {
      .stocks-table th:nth-child(4), .stocks-table td:nth-child(4) { display: none; }
      .stock-name { display: none; }
      .filter-group { flex-direction: column; align-items: flex-start; }
      .hide-tablet { display: none; }
    }
  </style>
</body>
</html>
