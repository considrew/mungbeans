<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5600315940410875"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ .Params.name }} ({{ .Params.symbol }}) - Is It Below The 200-Week Line?</title>
  <meta name="description" content="Is {{ .Params.name }} ({{ .Params.symbol }}) below its 200-week moving average? Check the signal, RSI, and historical touch data for value investors.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="{{ .Params.symbol }} {{ .Params.name }} - Below The Line">
  <meta property="og:description" content="Is {{ .Params.name }} below its 200-week moving average? Current signal: {{ if .Params.below_line }}YES - {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} below{{ else }}NO - {{ printf "%.1f%%" .Params.pct_from_wma }} above{{ end }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ .Permalink }}">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "{{ .Params.symbol }} - 200-Week Moving Average Signal",
    "description": "Track {{ .Params.symbol }} against its 200-week moving average",
    "url": "{{ .Permalink }}",
    "mainEntity": {
      "@type": "FinancialProduct",
      "name": "{{ .Params.symbol }}",
      "tickerSymbol": "{{ .Params.symbol }}"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ .Site.BaseURL }}"},
        {"@type": "ListItem", "position": 2, "name": "Stocks", "item": "{{ .Site.BaseURL }}stocks/"},
        {"@type": "ListItem", "position": 3, "name": "{{ .Params.symbol }}"}
      ]
    },
    "dateModified": "{{ .Params.last_updated }}"
  }
  </script>
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3" defer></script>
</head>
<body>
  <header class="site-header">
    <nav>
      <a href="/" class="logo">Below The Line</a>
      <a href="/stocks/">All Stocks</a>
      <a href="/about/">About</a>
    </nav>
  </header>

  <main class="stock-page">
    <div class="breadcrumb">
      <a href="/">Home</a> â†’ <a href="/stocks/">Stocks</a> â†’ {{ .Params.symbol }}
    </div>

    <h1>{{ .Params.symbol }}</h1>
    <p class="company-info">
      <span class="company-name">{{ .Params.name }}</span>
      {{ if .Params.sector }}<span class="sector">{{ .Params.sector }}</span>{{ end }}
      {{ if .Params.ir_url }}<a href="{{ .Params.ir_url }}" target="_blank" rel="noopener" class="ir-link">Investor Relations â†’</a>{{ end }}
    </p>
    
    <!-- Main Signal Box -->
    <div class="signal-box zone-{{ .Params.zone }}">
      <div class="signal-answer">
        {{ if .Params.below_line }}
          <span class="yes">YES</span>
        {{ else }}
          <span class="no">NO</span>
        {{ end }}
      </div>
      
      <div class="signal-detail">
        {{ if .Params.below_line }}
          {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} BELOW
        {{ else }}
          {{ printf "%.1f%%" .Params.pct_from_wma }} ABOVE
        {{ end }}
      </div>
      
      <div class="signal-direction">
        {{ if .Params.approaching }}
          <span class="approaching">â†“ Approaching</span>
          <span class="direction-detail">Was {{ printf "%.1f%%" (add .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week</span>
        {{ else }}
          <span class="retreating">â†‘ Moving away</span>
          <span class="direction-detail">Was {{ printf "%.1f%%" (sub .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week</span>
        {{ end }}
      </div>
    </div>

    <!-- Proximity Bar -->
    <div class="proximity-bar">
      <div class="bar-track">
        {{ $position := 50 }}
        {{ if gt .Params.pct_from_wma 15 }}
          {{ $position = 100 }}
        {{ else if lt .Params.pct_from_wma -15 }}
          {{ $position = 0 }}
        {{ else }}
          {{ $position = add (div (add .Params.pct_from_wma 15) 0.3) 0 }}
        {{ end }}
        <div class="bar-marker" style="left: {{ $position }}%"></div>
        <div class="bar-zones">
          <span class="zone zone-extreme">-15%</span>
          <span class="zone zone-deep">-10%</span>
          <span class="zone zone-below">-5%</span>
          <span class="zone zone-line">0%</span>
          <span class="zone zone-near">5%</span>
          <span class="zone zone-close">10%</span>
          <span class="zone zone-approach">15%+</span>
        </div>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-row">
      <div class="metric">
        <span class="metric-label">Buy Threshold</span>
        <span class="metric-value">${{ printf "%.2f" .Params.buy_threshold }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">14-Week RSI</span>
        <span class="metric-value {{ if lt .Params.rsi_14 30.0 }}oversold{{ else if gt .Params.rsi_14 70.0 }}overbought{{ end }}">
          {{ printf "%.0f" .Params.rsi_14 }}
          {{ if lt .Params.rsi_14 30.0 }} ðŸ“‰{{ end }}
        </span>
      </div>
    </div>

    <!-- Stock Analysis Prose -->
    <section class="stock-prose">
      {{/* === Paragraph 1: Current Signal Status === */}}
      <p>
        {{ .Params.name }} ({{ .Params.symbol }}) closed at ${{ printf "%.2f" .Params.close }} as of {{ .Params.last_updated }},
        {{ if .Params.below_line -}}
          trading {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} below its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}.
          This places {{ .Params.symbol }} in the <strong>{{ replace .Params.zone "_" " " }}</strong> zone.
        {{- else -}}
          trading {{ printf "%.1f%%" .Params.pct_from_wma }} above its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}.
        {{- end }}
        {{ if .Params.approaching -}}
          The stock is currently moving closer to the line, down from {{ printf "%.1f%%" (add .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week.
        {{- else -}}
          The stock moved further from the line this week, up from {{ printf "%.1f%%" (sub .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week.
        {{- end }}
        {{ if lt .Params.rsi_14 30.0 -}}
          With a 14-week RSI of {{ printf "%.0f" .Params.rsi_14 }}, {{ .Params.symbol }} is in oversold territory.
        {{- else if gt .Params.rsi_14 70.0 -}}
          With a 14-week RSI of {{ printf "%.0f" .Params.rsi_14 }}, {{ .Params.symbol }} is in overbought territory.
        {{- else -}}
          The 14-week RSI sits at {{ printf "%.0f" .Params.rsi_14 }}, indicating neutral momentum.
        {{- end }}
      </p>

      {{/* === Paragraph 2: Historical Touch Context === */}}
      {{ if gt .Params.touch_count 0 }}
      <p>
        Over the past {{ .Params.data_weeks }} weeks of data, {{ .Params.symbol }} has crossed below its 200-week moving average
        {{ .Params.touch_count }} time{{ if gt .Params.touch_count 1 }}s{{ end }}.
        {{ if .Params.avg_weeks_below -}}
          On average, these episodes lasted {{ printf "%.0f" .Params.avg_weeks_below }} weeks.
        {{- end }}
        {{ if .Params.avg_return_after_touch -}}
          {{ if gt .Params.avg_return_after_touch 0.0 -}}
            Historically, investors who bought {{ .Params.symbol }} at the start of these episodes saw an average one-year return of {{ printf "+%.1f%%" .Params.avg_return_after_touch }}.
          {{- else -}}
            The average one-year return after crossing below was {{ printf "%.1f%%" .Params.avg_return_after_touch }}, suggesting these dips have not historically been reliable buying opportunities for this stock.
          {{- end }}
        {{- end }}
      </p>
      {{ else }}
      <p>
        In {{ .Params.data_weeks }} weeks of available data, {{ .Params.symbol }} has never crossed below its 200-week moving average.
        This suggests the stock has maintained a strong long-term uptrend throughout its history.
      </p>
      {{ end }}

      {{/* === Paragraph 3: Fundamentals Snapshot === */}}
      {{ if or .Params.market_cap .Params.fcf_yield .Params.roe }}
      <p>
        {{ if .Params.market_cap -}}
          {{ if ge .Params.market_cap 1e12 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e12) }} trillion, {{ .Params.symbol }} is a mega-cap stock.
          {{- else if ge .Params.market_cap 1e10 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e9) }} billion, {{ .Params.symbol }} is a large-cap stock.
          {{- else if ge .Params.market_cap 2e9 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e9) }} billion, {{ .Params.symbol }} is a mid-cap stock.
          {{- else if .Params.market_cap -}}
            With a market cap of ${{ printf "%.0f" (div .Params.market_cap 1e6) }} million, {{ .Params.symbol }} is a small-cap stock.
          {{- end }}
        {{- end }}
        {{ if .Params.fcf_yield -}}
          {{ if gt .Params.fcf_yield 0.0 -}}
            The company generates a free cash flow yield of {{ printf "%.1f%%" .Params.fcf_yield }}{{ if ge .Params.fcf_yield 8.0 }}, which is notably high{{ else if ge .Params.fcf_yield 5.0 }}, which is healthy{{ end }}.
          {{- else -}}
            Free cash flow yield is currently negative, meaning the company is burning cash.
          {{- end }}
        {{- end }}
        {{ if .Params.roe -}}
          Return on equity stands at {{ printf "%.1f%%" .Params.roe }}{{ if ge .Params.roe 20.0 }}, indicating strong profitability{{ else if ge .Params.roe 15.0 }}, a solid level{{ end }}.
        {{- end }}
        {{ if .Params.price_to_book -}}
          The stock trades at {{ printf "%.1f" .Params.price_to_book }}x book value.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 4: Quality Flags & Shareholder Returns === */}}
      {{ if or .Params.dividend_aristocrat .Params.buffett_quality .Params.is_cannibal .Params.is_diluting .Params.yartseva_candidate }}
      <p>
        {{ if .Params.dividend_aristocrat -}}
          {{ .Params.symbol }} is a Dividend Aristocrat, having increased its dividend for 25 or more consecutive years.
          {{ if .Params.dividend_yield }}The current yield is {{ printf "%.2f%%" .Params.dividend_yield }}.{{ end }}
        {{- end }}
        {{ if .Params.is_cannibal -}}
          The company has been aggressively buying back shares, reducing its share count by {{ printf "%.1f%%" (math.Abs .Params.shares_change_3yr) }} over the past three years.
        {{- else if .Params.is_buying_back -}}
          Management has been repurchasing shares, with a {{ printf "%.1f%%" (math.Abs .Params.shares_change_3yr) }} reduction over three years.
        {{- else if .Params.is_diluting -}}
          Share count has increased {{ printf "%.1f%%" .Params.shares_change_3yr }} over three years, indicating dilution.
        {{- end }}
        {{ if .Params.buffett_quality -}}
          {{ .Params.symbol }} passes our Buffett quality screen: high return on equity, low debt, and positive free cash flow.
        {{- end }}
        {{ if .Params.yartseva_candidate -}}
          This stock also meets the Yartseva multibagger criteria as a small-cap with strong free cash flow yield and reasonable book value.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 5: Growth vs S&P 500 === */}}
      {{ if .Params.growth_stock_total }}
      <p>
        Over the past {{ .Params.growth_years }} years, a hypothetical investment of $100 in {{ .Params.symbol }} would have grown to
        ${{ printf "%.0f" (add 100 .Params.growth_stock_total) }}, compared to ${{ printf "%.0f" (add 100 .Params.growth_spy_total) }} for the S&amp;P 500.
        {{ if .Params.growth_beats_spy -}}
          That represents an annualized return of {{ printf "%.1f%%" .Params.growth_stock_annual }} vs {{ printf "%.1f%%" .Params.growth_spy_annual }} for the index â€”
          confirming {{ .Params.symbol }} as a market-beating investment and the kind of quality company where buying during
          200-week moving average touches has historically been rewarded.
        {{- else -}}
          {{ .Params.symbol }} has returned {{ printf "%.1f%%" .Params.growth_stock_annual }} annualized vs {{ printf "%.1f%%" .Params.growth_spy_annual }} for the index,
          underperforming the broader market over this period.
        {{- end }}
      </p>
      {{ end }}
    </section>

    <!-- Growth Chart: Stock vs S&P 500 -->
    {{ with .Params.growth_chart }}
    <section class="growth-chart-section">
      <h2>Growth of $100: {{ $.Params.symbol }} vs S&amp;P 500</h2>
      <div class="chart-container" style="position:relative; height:350px; max-width:800px;">
        <canvas id="growthChart"></canvas>
      </div>
      <p class="chart-note">Monthly data normalized to $100 at start. Vertical dashed lines mark 200-week MA touches.</p>
    </section>

    <script id="growthData" type="application/json">
      {{ . | jsonify | safeHTML }}
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      var raw = document.getElementById('growthData');
      if (!raw) return;
      var data = JSON.parse(raw.textContent);
      if (typeof data === 'string') data = JSON.parse(data);
      if (!data || !data.s || !data.b) return;

      var dollar = '\u0024';
      var parts = data.start.split('-');
      var startYear = parseInt(parts[0], 10);
      var startMonth = parseInt(parts[1], 10);
      var labels = data.s.map(function(_, i) {
        var d = new Date(startYear, startMonth - 1 + i, 1);
        return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
      });

      var annotations = {};
      (data.t || []).forEach(function(idx, i) {
        annotations['touch' + i] = {
          type: 'line',
          xMin: idx,
          xMax: idx,
          borderColor: 'rgba(239, 68, 68, 0.35)',
          borderWidth: 1.5,
          borderDash: [4, 4],
          label: { display: false }
        };
      });

      new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: '{{ $.Params.symbol }}',
              data: data.s,
              borderColor: '#2563eb',
              backgroundColor: 'rgba(37, 99, 235, 0.08)',
              fill: true,
              borderWidth: 2,
              pointRadius: 0,
              tension: 0.3
            },
            {
              label: 'S&P 500',
              data: data.b,
              borderColor: '#9ca3af',
              backgroundColor: 'transparent',
              fill: false,
              borderWidth: 1.5,
              borderDash: [5, 3],
              pointRadius: 0,
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          scales: {
            x: {
              ticks: { maxTicksLimit: 10, maxRotation: 0 },
              grid: { display: false }
            },
            y: {
              title: { display: true, text: 'Growth of ' + dollar + '100' },
              ticks: {
                callback: function(v) { return dollar + v; }
              }
            }
          },
          plugins: {
            legend: {
              position: 'top',
              labels: { usePointStyle: true, padding: 20 }
            },
            tooltip: {
              callbacks: {
                label: function(ctx) {
                  return ctx.dataset.label + ': ' + dollar + ctx.parsed.y;
                }
              }
            },
            annotation: { annotations: annotations }
          }
        }
      });
    });
    </script>
    {{ end }}

    <!-- Ad Placement: Rectangle -->
    <div class="ad-container ad-container--leaderboard" id="ad-stock-top">
      <div class="ad-label">Advertisement</div>
      <!-- Google AdSense or ad network code goes here -->
    </div>

    <!-- Historical Touches -->
    {{ if .Params.historical_touches }}
    <section class="historical-touches">
      <h2>Historical Touches</h2>
      <p class="touch-summary">
        {{ .Params.symbol }} has crossed below its 200-week MA 
        <strong>{{ .Params.touch_count }} time{{ if gt .Params.touch_count 1 }}s{{ end }}</strong>
        {{ if .Params.avg_return_after_touch }}
        with an average 1-year return of <strong>{{ printf "+%.1f%%" .Params.avg_return_after_touch }}</strong> after recovery.
        {{ end }}
      </p>
      
      <table class="touches-table">
        <thead>
          <tr>
            <th>Crossed Below</th>
            <th>Recovered</th>
            <th>Weeks</th>
            <th>Max Depth</th>
            <th>1-Year Return</th>
          </tr>
        </thead>
        <tbody>
          {{ range .Params.historical_touches }}
          <tr{{ if .ongoing }} class="ongoing"{{ end }}>
            <td>{{ .date }}</td>
            <td>{{ if .ongoing }}<em>Ongoing</em>{{ else if .recovery_date }}{{ .recovery_date }}{{ else }}â€”{{ end }}</td>
            <td>{{ .weeks_below }}{{ if .ongoing }}+{{ end }}</td>
            <td>{{ printf "%.1f%%" .max_depth }}</td>
            <td>
              {{ if .ongoing }}
                <em>Ongoing</em>
              {{ else if .return_1yr }}
                <span class="return {{ if gt .return_1yr 0.0 }}positive{{ else }}negative{{ end }}">
                  {{ if gt .return_1yr 0.0 }}+{{ end }}{{ printf "%.1f%%" .return_1yr }}
                </span>
              {{ else }}
                <em>N/A</em>
              {{ end }}
            </td>
          </tr>
          {{ end }}
        </tbody>
        {{ if and .Params.avg_return_after_touch .Params.avg_weeks_below }}
        <tfoot>
          <tr>
            <td><strong>Average</strong></td>
            <td></td>
            <td>{{ printf "%.0f" .Params.avg_weeks_below }}</td>
            <td>â€”</td>
            <td><strong>{{ printf "+%.1f%%" .Params.avg_return_after_touch }}</strong></td>
          </tr>
        </tfoot>
        {{ end }}
      </table>
    </section>
    {{ else }}
    <section class="no-touches">
      <h2>Historical Touches</h2>
      <p>{{ .Params.symbol }} has not crossed below its 200-week moving average in the available data ({{ .Params.data_weeks }} weeks).</p>
    </section>
    {{ end }}

    <!-- Disclaimer -->
    <div class="disclaimer">
      <p>
        <strong>Not financial advice.</strong> This is an educational tool. 
        Past performance does not guarantee future results. 
        Do your own research before making investment decisions.
      </p>
      <p class="last-updated">Data as of Friday close, {{ .Params.last_updated }}</p>
    </div>
  </main>

  <footer class="site-footer">
    <p>Â© {{ now.Year }} Below The Line. <a href="/disclaimer/">Disclaimer</a> Â· <a href="/privacy/">Privacy</a></p>
  </footer>
</body>
</html>
