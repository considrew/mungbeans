<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5600315940410875"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ .Params.symbol }} 200-Week Moving Average | {{ .Params.name }} {{ if .Params.below_line }}{{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} Below{{ else }}{{ printf "%.1f%%" .Params.pct_from_wma }} Above{{ end }} - mungbeans.io</title>
  <meta name="description" content="{{ .Params.name }} ({{ .Params.symbol }}) is {{ if .Params.below_line }}{{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} below{{ else }}{{ printf "%.1f%%" .Params.pct_from_wma }} above{{ end }} its 200-week moving average at ${{ printf "%.2f" .Params.close }}. {{ if .Params.below_line }}Signal: YES.{{ else }}Signal: NO.{{ end }} {{ if gt .Params.touch_count 0 }}{{ .Params.touch_count }} historical touches with {{ printf "%+.1f%%" .Params.avg_return_after_touch }} avg 1-year return.{{ end }} Updated weekly.">
  <link rel="canonical" href="{{ .Permalink }}">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  
  <!-- Open Graph -->
  <meta property="og:title" content="{{ .Params.symbol }} {{ if .Params.below_line }}{{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} Below{{ else }}{{ printf "%.1f%%" .Params.pct_from_wma }} Above{{ end }} 200-Week MA | {{ .Params.name }}">
  <meta property="og:description" content="{{ .Params.name }} at ${{ printf "%.2f" .Params.close }}. {{ if .Params.below_line }}Below the line â€” actionable signal.{{ else }}Above the line â€” watching.{{ end }}{{ if gt .Params.touch_count 0 }} {{ .Params.touch_count }} historical touches, {{ printf "%+.1f%%" .Params.avg_return_after_touch }} avg return.{{ end }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:site_name" content="mungbeans.io">
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "{{ .Params.symbol }} - 200-Week Moving Average Signal",
    "description": "Track {{ .Params.symbol }} against its 200-week moving average",
    "url": "{{ .Permalink }}",
    "mainEntity": {
      "@type": "FinancialProduct",
      "name": "{{ .Params.symbol }}",
      "tickerSymbol": "{{ .Params.symbol }}"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ .Site.BaseURL }}"},
        {"@type": "ListItem", "position": 2, "name": "Stocks", "item": "{{ .Site.BaseURL }}stocks/"},
        {"@type": "ListItem", "position": 3, "name": "{{ .Params.symbol }}"}
      ]
    },
    "dateModified": "{{ .Params.last_updated }}"
  }
  </script>
  
  <!-- FAQ Schema -->
  {{ $faqPct := "" }}
  {{ $faqWma := printf "%.2f" .Params.wma_200 }}
  {{ $faqRsi := "" }}
  {{ $faqFcf := "" }}
  {{ if .Params.below_line }}{{ $faqPct = printf "%.1f%%" (math.Abs .Params.pct_from_wma) }}{{ else }}{{ $faqPct = printf "%.1f%%" .Params.pct_from_wma }}{{ end }}
  {{ with .Params.rsi_14 }}{{ $faqRsi = printf "%.0f" . }}{{ end }}
  {{ with .Params.fcf_yield }}{{ if gt . 0.0 }}{{ $faqFcf = printf "%.1f%%" . }}{{ end }}{{ end }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is {{ .Params.symbol }} below its 200-week moving average?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ if .Params.below_line }}Yes. As of {{ .Params.last_updated }}, {{ .Params.name }} is trading {{ $faqPct }} below its 200-week moving average of ${{ $faqWma }}.{{ else }}No. {{ .Params.name }} is currently {{ $faqPct }} above its 200-week moving average of ${{ $faqWma }}.{{ end }}"
        }
      },
      {
        "@type": "Question",
        "name": "What is {{ .Params.symbol }}'s 200-week moving average price?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ .Params.name }}'s 200-week moving average is ${{ $faqWma }} as of {{ .Params.last_updated }}."
        }
      },
      {
        "@type": "Question",
        "name": "Is {{ .Params.symbol }} a good value right now?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ if .Params.below_line }}{{ .Params.symbol }} is below its 200-week moving average, which is the starting point for value analysis.{{ else }}{{ .Params.symbol }} is above its 200-week moving average, so it does not currently meet the primary signal.{{ end }}{{ if $faqRsi }} RSI is {{ $faqRsi }}.{{ end }}{{ if $faqFcf }} FCF yield is {{ $faqFcf }}.{{ end }} This is not financial advice."
        }
      }
    ]
  }
  </script>
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3" defer></script>
</head>
<body>
  <header class="site-header">
    <nav>
      <a href="/" class="logo">mungbeans.io</a>
      <a href="/stocks/">All Stocks</a>
      <a href="/blog/">Weekly Reports</a>
      <a href="/deep-dives/">Deep Dives</a>
      <a href="/about/">About</a>
    </nav>
  </header>

  <main class="stock-page">
    <div class="breadcrumb">
      <a href="/">Home</a> â†’ <a href="/stocks/">Stocks</a> â†’ {{ .Params.symbol }}
    </div>

    <h1>{{ .Params.symbol }}</h1>
    <p class="company-info">
      <span class="company-name">{{ .Params.name }}</span>
      {{ if .Params.sector }}<span class="sector">{{ .Params.sector }}</span>{{ end }}
      {{ if .Params.ir_url }}<a href="{{ .Params.ir_url }}" target="_blank" rel="noopener" class="ir-link">Investor Relations â†’</a>{{ end }}
    </p>
    
    <!-- Main Signal Box -->
    <div class="signal-box zone-{{ .Params.zone }}">
      <div class="signal-answer">
        {{ if .Params.below_line }}
          <span class="yes">YES</span>
        {{ else }}
          <span class="no">NO</span>
        {{ end }}
      </div>
      
      <div class="signal-detail">
        {{ if .Params.below_line }}
          {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} BELOW
        {{ else }}
          {{ printf "%.1f%%" .Params.pct_from_wma }} ABOVE
        {{ end }}
      </div>
      
      <div class="signal-direction">
        {{ if .Params.approaching }}
          <span class="approaching">â†“ Approaching</span>
          <span class="direction-detail">Was {{ printf "%.1f%%" (add .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week</span>
        {{ else }}
          <span class="retreating">â†‘ Moving away</span>
          <span class="direction-detail">Was {{ printf "%.1f%%" (sub .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week</span>
        {{ end }}
      </div>
    </div>

    <!-- Proximity Bar -->
    <div class="proximity-bar">
      <div class="bar-track">
        {{ $position := 50 }}
        {{ if gt .Params.pct_from_wma 15 }}
          {{ $position = 100 }}
        {{ else if lt .Params.pct_from_wma -15 }}
          {{ $position = 0 }}
        {{ else }}
          {{ $position = add (div (add .Params.pct_from_wma 15) 0.3) 0 }}
        {{ end }}
        <div class="bar-marker" style="left: {{ $position }}%"></div>
        <div class="bar-zones">
          <span class="zone zone-extreme">-15%</span>
          <span class="zone zone-deep">-10%</span>
          <span class="zone zone-below">-5%</span>
          <span class="zone zone-line">0%</span>
          <span class="zone zone-near">5%</span>
          <span class="zone zone-close">10%</span>
          <span class="zone zone-approach">15%+</span>
        </div>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-row">
      <div class="metric">
        <span class="metric-label">Buy Threshold</span>
        <span class="metric-value">${{ printf "%.2f" .Params.buy_threshold }}</span>
      </div>
      <div class="metric">
        <span class="metric-label">14-Week RSI</span>
        <span class="metric-value {{ if lt .Params.rsi_14 30.0 }}oversold{{ else if gt .Params.rsi_14 70.0 }}overbought{{ end }}">
          {{ printf "%.0f" .Params.rsi_14 }}
          {{ if lt .Params.rsi_14 30.0 }} ðŸ“‰{{ end }}
        </span>
      </div>
      {{ with .Params.rvol_14 }}
      <div class="metric">
        <span class="metric-label">Rel. Volume (14w)</span>
        <span class="metric-subtitle">This week's trading vs. the 14-week average</span>
        <span class="metric-value {{ if lt . 0.5 }}low-volume{{ else if gt . 2.0 }}high-volume{{ end }}">
          {{ printf "%.1fx" . }}
          {{ if lt . 0.5 }} â€” Quiet{{ else if gt . 2.0 }} â€” Surging{{ end }}
        </span>
      </div>
      {{ end }}
      {{ with .Params.accumulation_ratio }}
      <div class="metric">
        <span class="metric-label">Buyers vs. Sellers (14w)</span>
        <span class="metric-subtitle">Are up-weeks or down-weeks getting more volume?</span>
        <span class="metric-value {{ if gt . 1.5 }}accumulation{{ else if lt . 0.7 }}distribution{{ end }}">
          {{ printf "%.2f" . }}
          {{ if gt . 1.5 }} â€” Buyers winning{{ else if lt . 0.7 }} â€” Sellers winning{{ end }}
        </span>
      </div>
      {{ end }}
    </div>

    <!-- Stock Analysis Prose -->
    <section class="stock-prose">
      {{/* === Paragraph 1: Current Signal Status === */}}
      <p>
        {{ .Params.name }} ({{ .Params.symbol }}) closed at ${{ printf "%.2f" .Params.close }} as of {{ .Params.last_updated }},
        {{ if .Params.below_line -}}
          trading {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} below its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}.
          This places {{ .Params.symbol }} in the <strong>{{ replace .Params.zone "_" " " }}</strong> zone.
        {{- else -}}
          trading {{ printf "%.1f%%" .Params.pct_from_wma }} above its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}.
        {{- end }}
        {{ if .Params.approaching -}}
          The stock is currently moving closer to the line, down from {{ printf "%.1f%%" (add .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week.
        {{- else -}}
          The stock moved further from the line this week, up from {{ printf "%.1f%%" (sub .Params.pct_from_wma (math.Abs .Params.wow_change)) }} last week.
        {{- end }}
        {{ if lt .Params.rsi_14 30.0 -}}
          With a 14-week RSI of {{ printf "%.0f" .Params.rsi_14 }}, {{ .Params.symbol }} is in oversold territory.
        {{- else if gt .Params.rsi_14 70.0 -}}
          With a 14-week RSI of {{ printf "%.0f" .Params.rsi_14 }}, {{ .Params.symbol }} is in overbought territory.
        {{- else -}}
          The 14-week RSI sits at {{ printf "%.0f" .Params.rsi_14 }}, indicating neutral momentum.
        {{- end }}
      </p>

      {{/* === Volume Analysis === */}}
      {{ if .Params.rvol_14 }}
      <p>
        {{ if eq .Params.volume_signal "quiet_accumulation" }}
          Trading activity has gone quiet â€” just {{ printf "%.1fx" .Params.rvol_14 }} of its usual 14-week average. But the buying that is happening outweighs the selling ({{ printf "%.2f" .Params.accumulation_ratio }} buyers-vs-sellers ratio). When volume dries up but buyers are still showing up more than sellers, it can mean the worst of the selling is over and the stock is quietly building a floor.
        {{ else if eq .Params.volume_signal "capitulation" }}
          A big spike in selling this week â€” {{ printf "%.1fx" .Params.rvol_14 }} the usual volume, and the price dropped. Sometimes this kind of heavy selling marks the end of a decline. The idea is that the last reluctant holders have finally sold, leaving fewer sellers left to push the price lower.
        {{ else if eq .Params.volume_signal "breakout_volume" }}
          A big jump in activity this week â€” {{ printf "%.1fx" .Params.rvol_14 }} the usual volume, and the price went up. Significantly more people than usual decided to buy. This kind of surge, especially on a stock already below its 200-week average, can be an early sign that sentiment is shifting.
        {{ else if eq .Params.volume_signal "distribution" }}
          Over the past 14 weeks, down-weeks have had more trading volume than up-weeks ({{ printf "%.2f" .Params.accumulation_ratio }} buyers-vs-sellers ratio). That means when people are active, they're more often selling than buying. Sellers are still more in control than buyers.
        {{ else if eq .Params.volume_signal "accumulation" }}
          Over the past 14 weeks, up-weeks have carried more volume than down-weeks ({{ printf "%.2f" .Params.accumulation_ratio }} buyers-vs-sellers ratio). When trading picks up, it's more often on days the price is rising â€” buyers are showing more interest than sellers.
        {{ else }}
          Trading volume is running at {{ printf "%.1fx" .Params.rvol_14 }} of its 14-week average, which is in the normal range. The balance between buying and selling volume ({{ printf "%.2f" .Params.accumulation_ratio }} ratio) is neutral â€” neither side is clearly dominating.
        {{ end }}
      </p>
      {{ end }}

      {{/* === Paragraph 2: Historical Touch Context === */}}
      {{ if gt .Params.touch_count 0 }}
      <p>
        Over the past {{ .Params.data_weeks }} weeks of data, {{ .Params.symbol }} has crossed below its 200-week moving average
        {{ .Params.touch_count }} time{{ if gt .Params.touch_count 1 }}s{{ end }}.
        {{ if .Params.avg_weeks_below -}}
          On average, these episodes lasted {{ printf "%.0f" .Params.avg_weeks_below }} weeks.
        {{- end }}
        {{ if .Params.avg_return_after_touch -}}
          {{ if gt .Params.avg_return_after_touch 0.0 -}}
            Historically, investors who bought {{ .Params.symbol }} at the start of these episodes saw an average one-year return of {{ printf "+%.1f%%" .Params.avg_return_after_touch }}.
          {{- else -}}
            The average one-year return after crossing below was {{ printf "%.1f%%" .Params.avg_return_after_touch }}, suggesting these dips have not historically been reliable buying opportunities for this stock.
          {{- end }}
        {{- end }}
      </p>
      {{ else }}
      <p>
        In {{ .Params.data_weeks }} weeks of available data, {{ .Params.symbol }} has never crossed below its 200-week moving average.
        This suggests the stock has maintained a strong long-term uptrend throughout its history.
      </p>
      {{ end }}

      {{/* === Paragraph 3: Fundamentals Snapshot === */}}
      {{ if or .Params.market_cap .Params.fcf_yield .Params.roe }}
      <p>
        {{ if .Params.market_cap -}}
          {{ if ge .Params.market_cap 1e12 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e12) }} trillion, {{ .Params.symbol }} is a mega-cap stock.
          {{- else if ge .Params.market_cap 1e10 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e9) }} billion, {{ .Params.symbol }} is a large-cap stock.
          {{- else if ge .Params.market_cap 2e9 -}}
            With a market cap of ${{ printf "%.1f" (div .Params.market_cap 1e9) }} billion, {{ .Params.symbol }} is a mid-cap stock.
          {{- else if .Params.market_cap -}}
            With a market cap of ${{ printf "%.0f" (div .Params.market_cap 1e6) }} million, {{ .Params.symbol }} is a small-cap stock.
          {{- end }}
        {{- end }}
        {{ if .Params.fcf_yield -}}
          {{ if gt .Params.fcf_yield 0.0 -}}
            The company generates a free cash flow yield of {{ printf "%.1f%%" .Params.fcf_yield }}{{ if ge .Params.fcf_yield 8.0 }}, which is notably high{{ else if ge .Params.fcf_yield 5.0 }}, which is healthy{{ end }}.
          {{- else -}}
            Free cash flow yield is currently negative, meaning the company is burning cash.
          {{- end }}
        {{- end }}
        {{ if .Params.roe -}}
          Return on equity stands at {{ printf "%.1f%%" .Params.roe }}{{ if ge .Params.roe 20.0 }}, indicating strong profitability{{ else if ge .Params.roe 15.0 }}, a solid level{{ end }}.
        {{- end }}
        {{ if .Params.price_to_book -}}
          The stock trades at {{ printf "%.1f" .Params.price_to_book }}x book value.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 4: Quality Flags & Shareholder Returns === */}}
      {{ if or .Params.dividend_aristocrat .Params.buffett_quality .Params.is_cannibal .Params.is_diluting .Params.yartseva_candidate }}
      <p>
        {{ if .Params.dividend_aristocrat -}}
          {{ .Params.symbol }} is a Dividend Aristocrat, having increased its dividend for 25 or more consecutive years.
          {{ if .Params.dividend_yield }}The current yield is {{ printf "%.2f%%" .Params.dividend_yield }}.{{ end }}
        {{- end }}
        {{ if .Params.is_cannibal -}}
          The company has been aggressively buying back shares, reducing its share count by {{ printf "%.1f%%" (math.Abs .Params.shares_change_3yr) }} over the past three years.
        {{- else if .Params.is_buying_back -}}
          Management has been repurchasing shares, with a {{ printf "%.1f%%" (math.Abs .Params.shares_change_3yr) }} reduction over three years.
        {{- else if .Params.is_diluting -}}
          Share count has increased {{ printf "%.1f%%" .Params.shares_change_3yr }} over three years, indicating dilution.
        {{- end }}
        {{ if .Params.buffett_quality -}}
          {{ .Params.symbol }} passes our Buffett quality screen: high return on equity, low debt, and positive free cash flow.
        {{- end }}
        {{ if .Params.yartseva_candidate -}}
          This stock also meets the Yartseva multibagger criteria as a small-cap with strong free cash flow yield and reasonable book value.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 5: Growth vs S&P 500 === */}}
      {{ if .Params.growth_stock_total }}
      <p>
        Over the past {{ .Params.growth_years }} years, a hypothetical investment of $100 in {{ .Params.symbol }} would have grown to
        ${{ printf "%.0f" (add 100 .Params.growth_stock_total) }}, compared to ${{ printf "%.0f" (add 100 .Params.growth_spy_total) }} for the S&amp;P 500.
        {{ if .Params.growth_beats_spy -}}
          That represents an annualized return of {{ printf "%.1f%%" .Params.growth_stock_annual }} vs {{ printf "%.1f%%" .Params.growth_spy_annual }} for the index â€”
          confirming {{ .Params.symbol }} as a market-beating investment and the kind of quality company where buying during
          200-week moving average touches has historically been rewarded.
        {{- else -}}
          {{ .Params.symbol }} has returned {{ printf "%.1f%%" .Params.growth_stock_annual }} annualized vs {{ printf "%.1f%%" .Params.growth_spy_annual }} for the index,
          underperforming the broader market over this period.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 6: Insider Buying === */}}
      {{ if .Params.has_conviction_buy }}
      <p>
        In the past 12 months, corporate insiders have made {{ .Params.insider_buy_count_12m }} open-market
        purchase{{ if gt .Params.insider_buy_count_12m 1 }}s{{ end }} totaling
        ${{ lang.FormatNumber 0 .Params.insider_buy_total_12m }}.
        {{ if .Params.has_cluster_buy -}}
          Multiple insiders purchased within a 30-day window â€” a cluster buy pattern that
          historically signals management confidence in the company's prospects.
        {{- end }}
        {{ if .Params.insider_below_line -}}
          Notably, these purchases occurred while {{ .Params.symbol }} is trading below its 200-week moving average â€”
          insiders are buying when the market is most pessimistic.
        {{- end }}
      </p>
      {{ end }}

      {{/* === Paragraph 7: Free Cash Flow Trend === */}}
      {{ if and .Params.fcf_trend (ne .Params.fcf_trend "insufficient_data") }}
      <p>
        {{ if eq .Params.fcf_trend "growing" -}}
          Free cash flow has been growing{{ if .Params.fcf_cagr_3yr }} at a {{ .Params.fcf_cagr_3yr }}% compound annual rate{{ end }},
          with {{ .Params.fcf_consecutive_positive }} consecutive year{{ if gt .Params.fcf_consecutive_positive 1 }}s{{ end }} of positive cash generation.
          {{ if .Params.fcf_growing_below_line -}}
            A business generating more cash every year while trading below its 200-week moving average
            is exactly the kind of disconnect value investors look for.
          {{- end }}
        {{- else if eq .Params.fcf_trend "declining" -}}
          Free cash flow has been declining{{ if .Params.fcf_cagr_3yr }} at a {{ .Params.fcf_cagr_3yr }}% compound annual rate{{ end }}.
          A deteriorating cash flow trend warrants extra scrutiny â€” the stock may be cheap for a reason.
        {{- else -}}
          Free cash flow has been volatile over the past several years, making the quality of earnings
          harder to assess.
        {{- end }}
      </p>
      {{ end }}
    </section>

    <!-- Growth Chart: Stock vs S&P 500 -->
    {{ with .Params.growth_chart }}
    <section class="growth-chart-section">
      <h2>Growth of $100: {{ $.Params.symbol }} vs S&amp;P 500</h2>
      <div class="chart-container" style="position:relative; height:350px; max-width:800px;">
        <canvas id="growthChart"></canvas>
      </div>
      <p class="chart-note">Monthly data normalized to $100 at start. Vertical dashed lines mark 200-week MA touches.</p>
    </section>

    <script id="growthData" type="application/json">
      {{ . | jsonify | safeHTML }}
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      var raw = document.getElementById('growthData');
      if (!raw) return;
      var data = JSON.parse(raw.textContent);
      if (typeof data === 'string') data = JSON.parse(data);
      if (!data || !data.s || !data.b) return;

      var dollar = '\u0024';
      var parts = data.start.split('-');
      var startYear = parseInt(parts[0], 10);
      var startMonth = parseInt(parts[1], 10);
      var labels = data.s.map(function(_, i) {
        var d = new Date(startYear, startMonth - 1 + i, 1);
        return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
      });

      var annotations = {};
      (data.t || []).forEach(function(idx, i) {
        annotations['touch' + i] = {
          type: 'line',
          xMin: idx,
          xMax: idx,
          borderColor: 'rgba(239, 68, 68, 0.35)',
          borderWidth: 1.5,
          borderDash: [4, 4],
          label: { display: false }
        };
      });

      new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: '{{ $.Params.symbol }}',
              data: data.s,
              borderColor: '#2563eb',
              backgroundColor: 'rgba(37, 99, 235, 0.08)',
              fill: true,
              borderWidth: 2,
              pointRadius: 0,
              tension: 0.3
            },
            {
              label: 'S&P 500',
              data: data.b,
              borderColor: '#9ca3af',
              backgroundColor: 'transparent',
              fill: false,
              borderWidth: 1.5,
              borderDash: [5, 3],
              pointRadius: 0,
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          scales: {
            x: {
              ticks: { maxTicksLimit: 10, maxRotation: 0 },
              grid: { display: false }
            },
            y: {
              title: { display: true, text: 'Growth of ' + dollar + '100' },
              ticks: {
                callback: function(v) { return dollar + v; }
              }
            }
          },
          plugins: {
            legend: {
              position: 'top',
              labels: { usePointStyle: true, padding: 20 }
            },
            tooltip: {
              callbacks: {
                label: function(ctx) {
                  return ctx.dataset.label + ': ' + dollar + ctx.parsed.y;
                }
              }
            },
            annotation: { annotations: annotations }
          }
        }
      });
    });
    </script>
    {{ end }}

    <!-- Touch Overlay Chart: What happens after crossing below the line -->
    {{ with .Params.touch_chart }}
    <section class="touch-chart-section">
      <h2>What Happens After {{ $.Params.symbol }} Crosses Below the Line?</h2>

      {{ if $.Params.touch_avg_return_12m }}
      <p>
        Across {{ $.Params.touch_total_episodes }} historical episodes, buying {{ $.Params.symbol }} when it crossed below its
        200-week moving average produced an average return of
        <strong>{{ printf "%+.1f%%" $.Params.touch_avg_return_12m }}</strong> after 12 months
        (median {{ printf "%+.1f%%" $.Params.touch_median_return_12m }}),
        compared to <strong>{{ printf "%+.1f%%" $.Params.touch_spy_avg_return_12m }}</strong> for the S&amp;P 500 over the same periods.
        {{ if $.Params.touch_pct_positive_12m }}{{ printf "%.0f" $.Params.touch_pct_positive_12m }}% of those episodes were profitable after one year.{{ end }}
        {{ if $.Params.touch_avg_return_24m }}
        After 24 months, the average return was {{ printf "%+.1f%%" $.Params.touch_avg_return_24m }}
        vs {{ printf "%+.1f%%" $.Params.touch_spy_avg_return_24m }} for the index.
        {{ end }}
      </p>
      {{ end }}

      <div class="chart-container" style="position:relative; height:350px; max-width:800px;">
        <canvas id="touchOverlayChart"></canvas>
      </div>
      <p class="chart-note">Each line shows $100 invested at the moment {{ $.Params.symbol }} crossed below its 200-week MA. Bold blue = stock average. Gray dashed = S&amp;P 500 average over same periods.</p>
    </section>

    <script id="touchChartData" type="application/json">
      {{ . | jsonify | safeHTML }}
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      var raw = document.getElementById('touchChartData');
      if (!raw) return;
      var data = JSON.parse(raw.textContent);
      if (typeof data === 'string') data = JSON.parse(data);
      if (!data || !data.episodes) return;

      var dollar = '\u0024';
      // X-axis labels: Month 0, 1, 2, ... 24
      var maxMonths = Math.max(data.stock_avg.length, 25);
      var labels = [];
      for (var i = 0; i < maxMonths; i++) {
        labels.push(i === 0 ? 'Touch' : 'M' + i);
      }

      var datasets = [];

      // Individual episode lines (thin, semi-transparent)
      var colors = [
        'rgba(59,130,246,0.25)', 'rgba(16,185,129,0.25)', 'rgba(245,158,11,0.25)',
        'rgba(139,92,246,0.25)', 'rgba(236,72,153,0.25)', 'rgba(20,184,166,0.25)',
        'rgba(99,102,241,0.25)', 'rgba(244,63,94,0.25)', 'rgba(34,197,94,0.25)',
        'rgba(168,85,247,0.25)'
      ];
      data.episodes.forEach(function(ep, idx) {
        datasets.push({
          label: ep.date,
          data: ep.s,
          borderColor: colors[idx % colors.length],
          borderWidth: 1.5,
          pointRadius: 0,
          tension: 0.3,
          fill: false
        });
      });

      // Stock average line (bold blue)
      datasets.push({
        label: '{{ $.Params.symbol }} Avg',
        data: data.stock_avg,
        borderColor: '#2563eb',
        borderWidth: 3,
        pointRadius: 0,
        tension: 0.3,
        fill: false
      });

      // SPY average line (gray dashed)
      datasets.push({
        label: 'S&P 500 Avg',
        data: data.spy_avg,
        borderColor: '#6b7280',
        borderWidth: 2.5,
        borderDash: [6, 3],
        pointRadius: 0,
        tension: 0.3,
        fill: false
      });

      // $100 baseline
      var baseline = new Array(maxMonths).fill(100);
      datasets.push({
        label: dollar + '100 baseline',
        data: baseline,
        borderColor: 'rgba(0,0,0,0.15)',
        borderWidth: 1,
        borderDash: [3, 3],
        pointRadius: 0,
        fill: false
      });

      new Chart(document.getElementById('touchOverlayChart'), {
        type: 'line',
        data: { labels: labels, datasets: datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          scales: {
            x: {
              title: { display: true, text: 'Months since crossing below 200-week MA' },
              grid: { display: false }
            },
            y: {
              title: { display: true, text: 'Value of ' + dollar + '100' },
              ticks: { callback: function(v) { return dollar + v; } }
            }
          },
          plugins: {
            legend: {
              position: 'top',
              labels: {
                filter: function(item) {
                  // Only show avg lines and baseline in legend, not individual episodes
                  return item.text.indexOf('Avg') !== -1 || item.text.indexOf('baseline') !== -1;
                },
                usePointStyle: true, padding: 15
              }
            },
            tooltip: {
              callbacks: {
                label: function(ctx) {
                  return ctx.dataset.label + ': ' + dollar + ctx.parsed.y;
                }
              }
            }
          }
        }
      });
    });
    </script>
    {{ end }}

    <!-- Ad Placement: Rectangle -->
    <div class="ad-container ad-container--leaderboard" id="ad-stock-top">
      <div class="ad-label">Advertisement</div>
      <!-- Google AdSense or ad network code goes here -->
    </div>

    <!-- Insider Buying Table -->
    {{ if .Params.has_conviction_buy }}
    <section class="insider-buying">
      <h2>Insider Buying Activity</h2>
      <p class="insider-summary">
        <strong>{{ len .Params.insider_buys }} conviction buy{{ if gt (len .Params.insider_buys) 1 }}s{{ end }}</strong>
        in the past 12 months (purchases over $500K with meaningful position increases).
        {{ if .Params.has_cluster_buy }}<span class="cluster-flag">ðŸ”¥ Cluster Buy Detected</span>{{ end }}
      </p>
      <table class="insider-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Insider</th>
            <th>Title</th>
            <th>Value</th>
            <th>Shares</th>
            <th>Position +%</th>
          </tr>
        </thead>
        <tbody>
          {{ range .Params.insider_buys }}
          <tr>
            <td>{{ .date }}</td>
            <td>{{ .name }}</td>
            <td>{{ .title }}</td>
            <td>${{ lang.FormatNumber 0 .value }}</td>
            <td>{{ lang.FormatNumber 0 .shares }}</td>
            <td>{{ if .pct_position_increase }}{{ printf "+%.1f%%" .pct_position_increase }}{{ else }}<em>N/A</em>{{ end }}</td>
          </tr>
          {{ end }}
        </tbody>
      </table>
    </section>
    {{ end }}

    <!-- Historical Touches -->
    {{ if .Params.historical_touches }}
    <section class="historical-touches">
      <h2>Historical Touches</h2>
      <p class="touch-summary">
        {{ .Params.symbol }} has crossed below its 200-week MA 
        <strong>{{ .Params.touch_count }} time{{ if gt .Params.touch_count 1 }}s{{ end }}</strong>
        {{ if .Params.avg_return_after_touch }}
        with an average 1-year return of <strong>{{ printf "+%.1f%%" .Params.avg_return_after_touch }}</strong> after recovery.
        {{ end }}
      </p>
      
      <table class="touches-table">
        <thead>
          <tr>
            <th>Crossed Below</th>
            <th>Recovered</th>
            <th>Weeks</th>
            <th>Max Depth</th>
            <th>1-Year Return</th>
            <th>Return Since Touch</th>
          </tr>
        </thead>
        <tbody>
          {{ range .Params.historical_touches }}
          <tr{{ if .ongoing }} class="ongoing"{{ end }}>
            <td>{{ .date }}</td>
            <td>{{ if .ongoing }}<em>Ongoing</em>{{ else if .recovery_date }}{{ .recovery_date }}{{ else }}â€”{{ end }}</td>
            <td>{{ .weeks_below }}{{ if .ongoing }}+{{ end }}</td>
            <td>{{ printf "%.1f%%" .max_depth }}</td>
            <td>
              {{ if .ongoing }}
                <em>Ongoing</em>
              {{ else if .return_1yr }}
                <span class="return {{ if gt .return_1yr 0.0 }}positive{{ else }}negative{{ end }}">
                  {{ if gt .return_1yr 0.0 }}+{{ end }}{{ printf "%.1f%%" .return_1yr }}
                </span>
              {{ else }}
                <em>N/A</em>
              {{ end }}
            </td>
            <td>
              {{ if .return_to_now }}
                <span class="return {{ if gt .return_to_now 0.0 }}positive{{ else }}negative{{ end }}">
                  {{ if gt .return_to_now 0.0 }}+{{ end }}{{ printf "%.1f%%" .return_to_now }}
                </span>
              {{ else }}
                <em>N/A</em>
              {{ end }}
            </td>
          </tr>
          {{ end }}
        </tbody>
        {{ if and .Params.avg_return_after_touch .Params.avg_weeks_below }}
        <tfoot>
          <tr>
            <td><strong>Average</strong></td>
            <td></td>
            <td>{{ printf "%.0f" .Params.avg_weeks_below }}</td>
            <td>â€”</td>
            <td><strong>{{ printf "+%.1f%%" .Params.avg_return_after_touch }}</strong></td>
            <td>â€”</td>
          </tr>
        </tfoot>
        {{ end }}
      </table>
    </section>
    {{ else }}
    <section class="no-touches">
      <h2>Historical Touches</h2>
      <p>{{ .Params.symbol }} has not crossed below its 200-week moving average in the available data ({{ .Params.data_weeks }} weeks).</p>
    </section>
    {{ end }}

    <!-- FAQ Section -->
    <section class="stock-faq">
      <h2>Frequently Asked Questions</h2>

      <details>
        <summary>Is {{ .Params.symbol }} below its 200-week moving average?</summary>
        <p>
          {{ if .Params.below_line -}}
            Yes. As of {{ .Params.last_updated }}, {{ .Params.name }} ({{ .Params.symbol }}) is trading {{ printf "%.1f%%" (math.Abs .Params.pct_from_wma) }} below its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}. The current price is ${{ printf "%.2f" .Params.close }}.
          {{- else -}}
            No. {{ .Params.name }} ({{ .Params.symbol }}) is currently {{ printf "%.1f%%" .Params.pct_from_wma }} above its 200-week moving average of ${{ printf "%.2f" .Params.wma_200 }}. It would need to fall to ${{ printf "%.2f" .Params.buy_threshold }} to cross below the line.
          {{- end }}
        </p>
      </details>

      <details>
        <summary>What is {{ .Params.symbol }}'s 200-week moving average price?</summary>
        <p>
          {{ .Params.name }}'s 200-week moving average is ${{ printf "%.2f" .Params.wma_200 }} as of {{ .Params.last_updated }}. This is the average weekly closing price over roughly the last 4 years, and it acts as a long-term trend line. When a stock drops below this level, it can signal that the price has fallen far enough from the long-term trend to attract value-oriented investors.
        </p>
      </details>

      {{ if gt .Params.touch_count 0 }}
      <details>
        <summary>What happens when {{ .Params.symbol }} drops below its 200-week moving average?</summary>
        <p>
          {{ .Params.symbol }} has crossed below its 200-week moving average {{ .Params.touch_count }} time{{ if gt .Params.touch_count 1 }}s{{ end }} in our data.
          {{ if .Params.avg_return_after_touch -}}
            {{ if gt .Params.avg_return_after_touch 0.0 -}}
              On average, buying at that moment produced a one-year return of {{ printf "+%.1f%%" .Params.avg_return_after_touch }}. These dips have historically been decent entry points.
            {{- else -}}
              The average one-year return after these crossings was {{ printf "%.1f%%" .Params.avg_return_after_touch }}, meaning the dips were not reliable buying signals for this particular stock.
            {{- end }}
          {{- end }}
          {{ if .Params.avg_weeks_below }} These episodes lasted {{ printf "%.0f" .Params.avg_weeks_below }} weeks on average.{{ end }}
        </p>
      </details>
      {{ end }}

      <details>
        <summary>Is {{ .Params.symbol }} a good value right now?</summary>
        <p>
          Here's what our data says about {{ .Params.symbol }} as of {{ .Params.last_updated }}:
          {{ if .Params.below_line }}The stock is below its 200-week moving average, which is the starting point for our analysis.{{ else }}The stock is above its 200-week moving average, so it doesn't currently meet our primary signal.{{ end }}
          {{ if .Params.rsi_14 }} The 14-week RSI is {{ printf "%.0f" .Params.rsi_14 }}{{ if lt .Params.rsi_14 30.0 }} (oversold){{ else if gt .Params.rsi_14 70.0 }} (overbought){{ end }}.{{ end -}}
          {{ if .Params.fcf_yield }}{{ if gt .Params.fcf_yield 0.0 }} Free cash flow yield is {{ printf "%.1f%%" .Params.fcf_yield }}.{{ else }} Free cash flow is currently negative.{{ end }}{{ end -}}
          {{ if .Params.roe }} Return on equity is {{ printf "%.1f%%" .Params.roe }}.{{ end -}}
          {{ if .Params.price_to_book }} Price-to-book is {{ printf "%.1f" .Params.price_to_book }}x.{{ end }}
          This is not a buy or sell recommendation â€” always do your own research.
        </p>
      </details>

      {{ if .Params.growth_stock_total }}
      <details>
        <summary>How does {{ .Params.symbol }} compare to the S&amp;P 500?</summary>
        <p>
          Over the past {{ .Params.growth_years }} years, $100 invested in {{ .Params.symbol }} would have grown to ${{ printf "%.0f" (add 100 .Params.growth_stock_total) }}, compared to ${{ printf "%.0f" (add 100 .Params.growth_spy_total) }} for the S&amp;P 500. That's {{ printf "%.1f%%" .Params.growth_stock_annual }} annualized vs {{ printf "%.1f%%" .Params.growth_spy_annual }} for the index.
          {{ if .Params.growth_beats_spy }}{{ .Params.symbol }} has outperformed the broader market over this period.{{ else }}{{ .Params.symbol }} has underperformed the broader market over this period.{{ end }}
        </p>
      </details>
      {{ end }}

      {{ if .Params.dividend_yield }}
      <details>
        <summary>Does {{ .Params.symbol }} pay a dividend?</summary>
        <p>
          {{ if gt .Params.dividend_yield 0.0 -}}
            Yes. {{ .Params.name }} currently pays a dividend yield of {{ printf "%.2f%%" .Params.dividend_yield }}.
            {{ if .Params.dividend_aristocrat }} It is also a Dividend Aristocrat, meaning it has raised its dividend for 25 or more consecutive years.{{ end }}
          {{- else -}}
            {{ .Params.name }} does not currently pay a dividend.
          {{- end }}
        </p>
      </details>
      {{ end }}
    </section>

    <!-- Disclaimer -->
    <div class="disclaimer">
      <p>
        <strong>Not financial advice.</strong> This is an educational tool. 
        Past performance does not guarantee future results. 
        Do your own research before making investment decisions.
      </p>
      <p class="last-updated">Data as of week of {{ .Params.last_updated }}</p>
    </div>
  </main>

  <footer class="site-footer">
    <p>Â© {{ now.Year }} mungbeans.io. <a href="/disclaimer/">Disclaimer</a> Â· <a href="/privacy/">Privacy</a></p>
  </footer>
</body>
</html>
